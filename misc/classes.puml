@startuml
skinparam packageStyle rectangle
skinparam classAttributeIconSize 0
skinparam classFontStyle bold
skinparam ArrowColor #444444
skinparam ClassBorderColor #336699
skinparam ClassBackgroundColor #EEF4FF
skinparam PackageBorderColor #336699
skinparam PackageBackgroundColor #F8FBFF
skinparam NoteBackgroundColor #FFFFF0
skinparam NoteBorderColor #AAAAAA
skinparam linetype ortho

package "Google A2A Protocol (v0.2.5)" {

    ' ─────────────────────────────────────
    ' BASE MODEL
    ' ─────────────────────────────────────

    abstract class A2ABaseModel {
        ' Pydantic base for all A2A types
    }

    ' ─────────────────────────────────────
    ' ENUMS
    ' ─────────────────────────────────────

    enum TaskState {
        submitted
        working
        input_required
        auth_required
        completed
        failed
        canceled
        rejected
        unknown
    }

    enum Role {
        user
        agent
    }

    enum In {
        header
        query
        cookie
    }

    enum TransportType {
        JSONRPC
        GRPC
        HTTP_JSON
    }

    ' ─────────────────────────────────────
    ' AGENT DISCOVERY: AgentCard & related
    ' ─────────────────────────────────────

    class AgentCard {
        + string name
        + string description
        + string url
        + string version
        + string protocolVersion = "0.2.5"
        + string iconUrl
        + string documentationUrl
        + string[] defaultInputModes
        + string[] defaultOutputModes
        + boolean supportsAuthenticatedExtendedCard
        --
        ' provider: AgentProvider (optional)
        ' capabilities: AgentCapabilities
        ' skills: AgentSkill[]
        ' securitySchemes: Map<string, SecurityScheme> (optional)
        ' security: List<Map<string, string[]>> (optional)
        ' extensions: AgentExtension[] (optional)
        ' interfaces: AgentInterface[] (optional)
    }

    note right of AgentCard
      Published at:
      /.well-known/agent.json
      (unauthenticated public card)
      Extended card may require auth.
    end note

    class AgentProvider {
        + string organization
        + string url
    }

    class AgentCapabilities {
        + boolean streaming
        + boolean pushNotifications
        + boolean stateTransitionHistory
        --
        ' extensions: AgentExtension[] (optional)
    }

    class AgentSkill {
        + string id
        + string name
        + string description
        + string[] tags
        + string[] examples (optional)
        + string[] inputModes (optional)
        + string[] outputModes (optional)
    }

    class AgentInterface {
        + string url
        --
        ' transport: TransportType
    }

    note bottom of AgentInterface
      transport values:
      "JSONRPC", "GRPC", "HTTP+JSON"
    end note

    class AgentExtension {
        + string uri
        + string description (optional)
        + boolean required (optional)
        + Map<string, any> params (optional)
    }

    class AgentCardSignature {
        + string keyId
        + string alg
        + string signature
        + string canonicalization
    }

    ' ─────────────────────────────────────
    ' TASK LIFECYCLE
    ' ─────────────────────────────────────

    class Task {
        + string id
        + string contextId
        + string kind = "task"
        --
        ' status: TaskStatus
        ' history: Message[] (optional)
        ' artifacts: Artifact[] (optional)
        ' metadata: Map<string, any> (optional)
    }

    class TaskStatus {
        + string timestamp (ISO 8601, optional)
        --
        ' state: TaskState
        ' message: Message (optional — last agent message)
    }

    ' ─────────────────────────────────────
    ' MESSAGING
    ' ─────────────────────────────────────

    class Message {
        + string messageId
        + string kind = "message"
        + string taskId (optional)
        + string contextId (optional)
        + string[] referenceTaskIds (optional)
        + string[] extensions (optional)
        + Map<string, any> metadata (optional)
        --
        ' role: Role
        ' parts: Part[]
    }

    abstract class Part {
        + Map<string, any> metadata (optional)
    }

    class TextPart {
        + string kind = "text"
        + string text
    }

    class FilePart {
        + string kind = "file"
        --
        ' file: FileWithBytes | FileWithUri
    }

    class DataPart {
        + string kind = "data"
        + Map<string, any> data
    }

    class FileWithBytes {
        + string bytes  ' base64-encoded
        + string name (optional)
        + string mimeType (optional)
    }

    class FileWithUri {
        + string uri
        + string name (optional)
        + string mimeType (optional)
    }

    ' ─────────────────────────────────────
    ' ARTIFACTS
    ' ─────────────────────────────────────

    class Artifact {
        + string artifactId
        + string name (optional)
        + string description (optional)
        + string[] extensions (optional)
        + Map<string, any> metadata (optional)
        --
        ' parts: Part[]
    }

    ' ─────────────────────────────────────
    ' STREAMING EVENTS
    ' ─────────────────────────────────────

    class TaskStatusUpdateEvent {
        + string taskId
        + string contextId
        + string kind = "status-update"
        + boolean final
        --
        ' status: TaskStatus
        ' metadata: Map<string, any> (optional)
    }

    class TaskArtifactUpdateEvent {
        + string taskId
        + string contextId
        + string kind = "artifact-update"
        + boolean append (optional)
        + boolean lastChunk (optional)
        --
        ' artifact: Artifact
        ' metadata: Map<string, any> (optional)
    }

    ' ─────────────────────────────────────
    ' PUSH NOTIFICATIONS
    ' ─────────────────────────────────────

    class PushNotificationConfig {
        + string url
        + string id (optional)
        + string token (optional)
        --
        ' authentication: PushNotificationAuthenticationInfo (optional)
    }

    class PushNotificationAuthenticationInfo {
        + string[] schemes
        + string credentials (optional)
    }

    class TaskPushNotificationConfig {
        + string taskId
        --
        ' pushNotificationConfig: PushNotificationConfig
    }

    ' ─────────────────────────────────────
    ' SECURITY SCHEMES
    ' ─────────────────────────────────────

    abstract class SecurityScheme {
        + string type
        + string description (optional)
    }

    class APIKeySecurityScheme {
        + string type = "apiKey"
        + string name
        --
        ' in_: In (header | query | cookie)
    }

    class HTTPAuthSecurityScheme {
        + string type = "http"
        + string scheme
        + string bearerFormat (optional)
    }

    class OAuth2SecurityScheme {
        + string type = "oauth2"
        --
        ' flows: OAuthFlows
    }

    class OpenIdConnectSecurityScheme {
        + string type = "openIdConnect"
        + string openIdConnectUrl
    }

    class MutualTlsSecurityScheme {
        + string type = "mutualTLS"
    }

    class OAuthFlows {
        --
        ' implicit: ImplicitOAuthFlow (optional)
        ' password: PasswordOAuthFlow (optional)
        ' clientCredentials: ClientCredentialsOAuthFlow (optional)
        ' authorizationCode: AuthorizationCodeOAuthFlow (optional)
        ' deviceCode: DeviceCodeOAuthFlow (optional)
    }

    class ImplicitOAuthFlow {
        + string authorizationUrl
        + string refreshUrl (optional)
        + Map<string, string> scopes
    }

    class PasswordOAuthFlow {
        + string tokenUrl
        + string refreshUrl (optional)
        + Map<string, string> scopes
    }

    class ClientCredentialsOAuthFlow {
        + string tokenUrl
        + string refreshUrl (optional)
        + Map<string, string> scopes
    }

    class AuthorizationCodeOAuthFlow {
        + string authorizationUrl
        + string tokenUrl
        + string refreshUrl (optional)
        + Map<string, string> scopes
    }

    class DeviceCodeOAuthFlow {
        + string deviceAuthorizationUrl
        + string tokenUrl
        + string refreshUrl (optional)
        + Map<string, string> scopes
    }

    ' ─────────────────────────────────────
    ' JSON-RPC LAYER
    ' ─────────────────────────────────────

    class JSONRPCMessage {
        + string jsonrpc = "2.0"
        + string | int id (optional)
    }

    class JSONRPCRequest {
        + string jsonrpc = "2.0"
        + string method
        + string | int id (optional)
        --
        ' params: object (optional)
    }

    class JSONRPCSuccessResponse {
        + string jsonrpc = "2.0"
        + string | int id (optional)
        --
        ' result: any
    }

    class JSONRPCErrorResponse {
        + string jsonrpc = "2.0"
        + string | int id (optional)
        --
        ' error: JSONRPCError (union of all error types)
    }

    class JSONRPCError {
        + int code
        + string message
        + any data (optional)
    }

    ' ─────────────────────────────────────
    ' ERROR TYPES (A2A-specific + standard)
    ' ─────────────────────────────────────

    class JSONParseError {
        + int code = -32700
        + string message = "Invalid JSON payload"
        + any data (optional)
    }

    class InvalidRequestError {
        + int code = -32600
        + string message = "Request payload validation error"
        + any data (optional)
    }

    class MethodNotFoundError {
        + int code = -32601
        + string message = "Method not found"
        + any data (optional)
    }

    class InvalidParamsError {
        + int code = -32602
        + string message = "Invalid parameters"
        + any data (optional)
    }

    class InternalError {
        + int code = -32603
        + string message = "Internal error"
        + any data (optional)
    }

    class TaskNotFoundError {
        + int code = -32001
        + string message = "Task not found"
        + any data (optional)
    }

    class TaskNotCancelableError {
        + int code = -32002
        + string message = "Task cannot be canceled"
        + any data (optional)
    }

    class PushNotificationNotSupportedError {
        + int code = -32003
        + string message = "Push Notification is not supported"
        + any data (optional)
    }

    class UnsupportedOperationError {
        + int code = -32004
        + string message = "This operation is not supported"
        + any data (optional)
    }

    class ContentTypeNotSupportedError {
        + int code = -32005
        + string message = "Incompatible content types"
        + any data (optional)
    }

    class InvalidAgentResponseError {
        + int code = -32006
        + string message = "Invalid agent response"
        + any data (optional)
    }

    ' ─────────────────────────────────────
    ' OPERATION PAYLOADS — Requests
    ' ─────────────────────────────────────

    class SendMessageRequest {
        + string jsonrpc = "2.0"
        + string method = "message/send"
        + string | int id
        --
        ' params: MessageSendParams
    }

    class SendStreamingMessageRequest {
        + string jsonrpc = "2.0"
        + string method = "message/stream"
        + string | int id
        --
        ' params: MessageSendParams
    }

    class MessageSendParams {
        + string contextId (optional)
        + Map<string, any> metadata (optional)
        --
        ' message: Message
        ' configuration: MessageSendConfiguration (optional)
    }

    class MessageSendConfiguration {
        + string[] acceptedOutputModes
        + boolean blocking (optional)
        + int historyLength (optional)
        --
        ' pushNotificationConfig: PushNotificationConfig (optional)
    }

    class GetTaskRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/get"
        + string | int id
        --
        ' params: TaskQueryParams
    }

    class TaskQueryParams {
        + string id
        + int historyLength (optional)
        + Map<string, any> metadata (optional)
    }

    class ListTasksRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/list"
        + string | int id
        --
        ' params: TaskListParams (optional)
    }

    class TaskListParams {
        + string contextId (optional)
        + string status (optional)
        + int pageSize (optional)
        + string pageToken (optional)
        + int historyLength (optional)
    }

    class CancelTaskRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/cancel"
        + string | int id
        --
        ' params: TaskIdParams
    }

    class TaskIdParams {
        + string id
        + Map<string, any> metadata (optional)
    }

    class ResubscribeToTaskRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/resubscribe"
        + string | int id
        --
        ' params: TaskIdParams
    }

    class SetTaskPushNotificationConfigRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/pushNotificationConfig/set"
        + string | int id
        --
        ' params: TaskPushNotificationConfig
    }

    class GetTaskPushNotificationConfigRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/pushNotificationConfig/get"
        + string | int id
        --
        ' params: TaskIdParams
    }

    class ListTaskPushNotificationConfigRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/pushNotificationConfig/list"
        + string | int id
        --
        ' params: TaskIdParams
    }

    class DeleteTaskPushNotificationConfigRequest {
        + string jsonrpc = "2.0"
        + string method = "tasks/pushNotificationConfig/delete"
        + string | int id
        --
        ' params: PushNotificationConfigIdentifier
    }

    class PushNotificationConfigIdentifier {
        + string id
        + string taskId (optional)
    }

    ' ─────────────────────────────────────
    ' OPERATION PAYLOADS — Responses
    ' ─────────────────────────────────────

    class SendMessageResponse {
        ' result: Task | Message
    }

    class GetTaskResponse {
        ' result: Task
    }

    class CancelTaskResponse {
        ' result: Task
    }

    class SetTaskPushNotificationConfigResponse {
        ' result: TaskPushNotificationConfig
    }

    class GetTaskPushNotificationConfigResponse {
        ' result: TaskPushNotificationConfig
    }

    class ListTaskPushNotificationConfigResponse {
        ' result: TaskPushNotificationConfig[]
    }

    ' ─────────────────────────────────────
    ' SERVICE LAYER
    ' ─────────────────────────────────────

    interface A2AServer {
        + AgentCard getAgentCard()
        + AgentCard getExtendedAgentCard()
        + Task|Message sendMessage(SendMessageRequest)
        + Stream<Event> sendStreamingMessage(SendStreamingMessageRequest)
        + Task getTask(GetTaskRequest)
        + Task[] listTasks(ListTasksRequest)
        + Task cancelTask(CancelTaskRequest)
        + Stream<Event> resubscribeToTask(ResubscribeToTaskRequest)
        + TaskPushNotificationConfig setPushNotificationConfig(SetTaskPushNotificationConfigRequest)
        + TaskPushNotificationConfig getPushNotificationConfig(GetTaskPushNotificationConfigRequest)
        + TaskPushNotificationConfig[] listPushNotificationConfigs(ListTaskPushNotificationConfigRequest)
        + void deletePushNotificationConfig(DeleteTaskPushNotificationConfigRequest)
    }

    class A2AClient {
        + A2AClient(string agentUrl)
        + AgentCard discover()
        + Task|Message sendMessage(Message, MessageSendConfiguration)
        + Stream<Event> sendStreamingMessage(Message, MessageSendConfiguration)
        + Task getTask(string taskId, int historyLength)
        + Task[] listTasks(TaskListParams)
        + Task cancelTask(string taskId)
        + Stream<Event> resubscribeToTask(string taskId)
        + TaskPushNotificationConfig setPushNotificationConfig(string taskId, PushNotificationConfig)
        + TaskPushNotificationConfig getPushNotificationConfig(string taskId)
        + TaskPushNotificationConfig[] listPushNotificationConfigs(string taskId)
        + void deletePushNotificationConfig(string pushConfigId)
    }

    abstract class AgentExecutor {
        + {abstract} void execute(RequestContext, EventQueue)
        + {abstract} void cancel(RequestContext, EventQueue)
    }

    class RequestContext {
        + string taskId
        + string contextId
        + Message message
        + Task currentTask (optional)
        + string getUserInput()
    }

    class EventQueue {
        + void enqueueEvent(TaskStatusUpdateEvent | TaskArtifactUpdateEvent)
        + void close()
    }

    ' ─────────────────────────────────────
    ' RELATIONSHIPS
    ' ─────────────────────────────────────

    ' Base model inheritance
    A2ABaseModel <|-- AgentCard
    A2ABaseModel <|-- AgentCapabilities
    A2ABaseModel <|-- AgentSkill
    A2ABaseModel <|-- AgentProvider
    A2ABaseModel <|-- AgentInterface
    A2ABaseModel <|-- AgentExtension
    A2ABaseModel <|-- Task
    A2ABaseModel <|-- TaskStatus
    A2ABaseModel <|-- Message
    A2ABaseModel <|-- Part
    A2ABaseModel <|-- Artifact
    A2ABaseModel <|-- PushNotificationConfig
    A2ABaseModel <|-- TaskPushNotificationConfig
    A2ABaseModel <|-- SecurityScheme

    ' AgentCard composition
    AgentCard "1" *-- "1" AgentCapabilities : has
    AgentCard "1" *-- "0..1" AgentProvider : providedBy
    AgentCard "1" *-- "1..*" AgentSkill : exposes
    AgentCard "1" *-- "0..*" AgentInterface : supportsTransportVia
    AgentCard "1" *-- "0..*" AgentExtension : declares
    AgentCard "1" *-- "0..*" AgentCardSignature : signedWith
    AgentCard "1" *-- "0..*" SecurityScheme : securedBy

    ' AgentInterface uses TransportType
    AgentInterface ..> TransportType : uses

    ' APIKeySecurityScheme uses In
    APIKeySecurityScheme ..> In : location

    ' Task composition
    Task "1" *-- "1" TaskStatus : hasStatus
    Task "1" *-- "0..*" Message : history
    Task "1" *-- "0..*" Artifact : produces
    TaskStatus "1" *-- "1" TaskState : state
    TaskStatus "0..1" *-- "0..1" Message : lastAgentMessage

    ' Message composition
    Message "1" *-- "1..*" Part : consistsOf
    Message "1" -- "1" Role : sentBy

    ' Part subtypes
    Part <|-- TextPart
    Part <|-- FilePart
    Part <|-- DataPart
    FilePart "1" *-- "1" FileWithBytes : orBytes
    FilePart "1" *-- "1" FileWithUri : orUri

    ' Artifact composition
    Artifact "1" *-- "1..*" Part : madeOf

    ' Streaming events
    TaskStatusUpdateEvent "1" *-- "1" TaskStatus : carries
    TaskArtifactUpdateEvent "1" *-- "1" Artifact : carries

    ' Push notification composition
    PushNotificationConfig "1" *-- "0..1" PushNotificationAuthenticationInfo : securedBy
    TaskPushNotificationConfig "1" *-- "1" PushNotificationConfig : wraps

    ' Security scheme subtypes
    SecurityScheme <|-- APIKeySecurityScheme
    SecurityScheme <|-- HTTPAuthSecurityScheme
    SecurityScheme <|-- OAuth2SecurityScheme
    SecurityScheme <|-- OpenIdConnectSecurityScheme
    SecurityScheme <|-- MutualTlsSecurityScheme
    OAuth2SecurityScheme "1" *-- "1" OAuthFlows : defines
    OAuthFlows "0..1" *-- "0..1" ImplicitOAuthFlow : implicit
    OAuthFlows "0..1" *-- "0..1" PasswordOAuthFlow : password
    OAuthFlows "0..1" *-- "0..1" ClientCredentialsOAuthFlow : clientCredentials
    OAuthFlows "0..1" *-- "0..1" AuthorizationCodeOAuthFlow : authorizationCode
    OAuthFlows "0..1" *-- "0..1" DeviceCodeOAuthFlow : deviceCode

    ' JSON-RPC hierarchy
    JSONRPCMessage <|-- JSONRPCRequest
    JSONRPCMessage <|-- JSONRPCSuccessResponse
    JSONRPCMessage <|-- JSONRPCErrorResponse
    JSONRPCErrorResponse "1" *-- "1" JSONRPCError : containsOnError

    ' Error type hierarchy
    JSONRPCError <|-- JSONParseError
    JSONRPCError <|-- InvalidRequestError
    JSONRPCError <|-- MethodNotFoundError
    JSONRPCError <|-- InvalidParamsError
    JSONRPCError <|-- InternalError
    JSONRPCError <|-- TaskNotFoundError
    JSONRPCError <|-- TaskNotCancelableError
    JSONRPCError <|-- PushNotificationNotSupportedError
    JSONRPCError <|-- UnsupportedOperationError
    JSONRPCError <|-- ContentTypeNotSupportedError
    JSONRPCError <|-- InvalidAgentResponseError

    ' Request payloads (all extend JSONRPCRequest)
    JSONRPCRequest <|-- SendMessageRequest
    JSONRPCRequest <|-- SendStreamingMessageRequest
    JSONRPCRequest <|-- GetTaskRequest
    JSONRPCRequest <|-- ListTasksRequest
    JSONRPCRequest <|-- CancelTaskRequest
    JSONRPCRequest <|-- ResubscribeToTaskRequest
    JSONRPCRequest <|-- SetTaskPushNotificationConfigRequest
    JSONRPCRequest <|-- GetTaskPushNotificationConfigRequest
    JSONRPCRequest <|-- ListTaskPushNotificationConfigRequest
    JSONRPCRequest <|-- DeleteTaskPushNotificationConfigRequest

    ' Response payloads (all extend JSONRPCSuccessResponse)
    JSONRPCSuccessResponse <|-- SendMessageResponse
    JSONRPCSuccessResponse <|-- GetTaskResponse
    JSONRPCSuccessResponse <|-- CancelTaskResponse
    JSONRPCSuccessResponse <|-- SetTaskPushNotificationConfigResponse
    JSONRPCSuccessResponse <|-- GetTaskPushNotificationConfigResponse
    JSONRPCSuccessResponse <|-- ListTaskPushNotificationConfigResponse

    ' Request params composition
    SendMessageRequest "1" *-- "1" MessageSendParams : params
    SendStreamingMessageRequest "1" *-- "1" MessageSendParams : params
    MessageSendParams "1" *-- "1" Message : includes
    MessageSendParams "0..1" *-- "0..1" MessageSendConfiguration : configuredBy
    MessageSendConfiguration "0..1" *-- "0..1" PushNotificationConfig : notifyVia

    GetTaskRequest "1" *-- "1" TaskQueryParams : params
    ListTasksRequest "0..1" *-- "0..1" TaskListParams : params
    CancelTaskRequest "1" *-- "1" TaskIdParams : params
    ResubscribeToTaskRequest "1" *-- "1" TaskIdParams : params
    SetTaskPushNotificationConfigRequest "1" *-- "1" TaskPushNotificationConfig : params
    GetTaskPushNotificationConfigRequest "1" *-- "1" TaskIdParams : params
    ListTaskPushNotificationConfigRequest "1" *-- "1" TaskIdParams : params
    DeleteTaskPushNotificationConfigRequest "1" *-- "1" PushNotificationConfigIdentifier : params

    ' Service layer
    A2AServer ..> AgentCard : exposes
    A2AServer ..> Task : manages
    A2AServer ..> TaskStatusUpdateEvent : emits
    A2AServer ..> TaskArtifactUpdateEvent : emits
    A2AServer ..> PushNotificationConfig : manages
    A2AServer ..> AgentExecutor : delegatesTo

    A2AClient ..> SendMessageRequest : constructs
    A2AClient ..> SendStreamingMessageRequest : constructs
    A2AClient ..> Task : receives
    A2AClient ..> TaskStatusUpdateEvent : receives
    A2AClient ..> TaskArtifactUpdateEvent : receives
    A2AClient --> A2AServer : communicatesVia HTTP/JSON-RPC/gRPC

    AgentExecutor ..> RequestContext : processes
    AgentExecutor ..> EventQueue : publishesTo
    EventQueue ..> TaskStatusUpdateEvent : queues
    EventQueue ..> TaskArtifactUpdateEvent : queues
}

legend right
  |= Symbol    |= Meaning              |
  | *--        | Composition           |
  | <|--       | Inheritance/Subtype   |
  | ..>        | Dependency/Usage      |
  | -->        | Association           |
  Sources: a2aprotocol.ai spec v0.2.5,
  official Python SDK types.py,
  GitHub a2aproject/A2A
endlegend

@enduml
